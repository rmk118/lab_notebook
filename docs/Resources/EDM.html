<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="An overview of Empirical Dynamic Modeling (EDM). The goal is to perform somewhat of a literature review and solidify my understanding of EDM and its applications by describing the concepts in my own words, or at least compile language from the various sources that have been most helpful in building my intuition around EDM.">

<title>Ruby’s Lab Notebook - Summer 2023 - Intro to EDM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Resources/Papers.html">Resources</a></li><li class="breadcrumb-item"><a href="../Resources/EDM.html">Intro to EDM</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Ruby’s Lab Notebook - Summer 2023</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Resources/Papers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Relevant Papers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Resources/EDM.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Intro to EDM</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Project Updates</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/Jun9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">June 9</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/Jun8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">June 8</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/Jun7/Jun7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">June 7</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../posts/Jun6/Jun6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">June 6</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#simplex-projection" id="toc-simplex-projection" class="nav-link" data-scroll-target="#simplex-projection">Simplex Projection</a></li>
  <li><a href="#s-map-analysis" id="toc-s-map-analysis" class="nav-link" data-scroll-target="#s-map-analysis">S-Map Analysis</a></li>
  <li><a href="#convergent-cross-mapping-ccm" id="toc-convergent-cross-mapping-ccm" class="nav-link" data-scroll-target="#convergent-cross-mapping-ccm">Convergent Cross-Mapping (CCM)</a></li>
  </ul></li>
  <li><a href="#spatial-edm" id="toc-spatial-edm" class="nav-link" data-scroll-target="#spatial-edm">Spatial EDM</a></li>
  <li><a href="#other-edm-papers" id="toc-other-edm-papers" class="nav-link" data-scroll-target="#other-edm-papers">Other EDM papers</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro to EDM</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Resources</div>
  </div>
  </div>

<div>
  <div class="description">
    An overview of Empirical Dynamic Modeling (EDM). The goal is to perform somewhat of a literature review and solidify my understanding of EDM and its applications by describing the concepts in my own words, or at least compile language from the various sources that have been most helpful in building my intuition around EDM.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 11, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>A dynamical system is a system whose state is uniquely specified by a set of variables (state variables) and whose behavior is described by predefined rules <span class="citation" data-cites="sayama2015">(<a href="#ref-sayama2015" role="doc-biblioref">Sayama 2015</a>)</span>. The dynamical system evolves over time in the state space, which is the set of all possible values of the state variables. If a state space is continuous (i.e., the state variables are not restricted to discrete values) and finite-dimensional, the number of state variables defines the dimension of the dynamical system.</p>
<p>If a dynamical system is deterministic, future states of the system can be predicted from the past behavior of the system, even if the trajectories appear chaotic <span class="citation" data-cites="sugihara1990">(<a href="#ref-sugihara1990" role="doc-biblioref">Sugihara and May 1990</a>)</span>. In a nonlinear system, interactions between variables are state-dependent: for example, the correlation between fish and zooplankton populations in the Baltic Sea changes sign depending on planktivore abundance, with two different ecosystem configurations (top-down vs.&nbsp;bottom-up forcing) on either side of a planktivore threshold <span class="citation" data-cites="casini2009">(<a href="#ref-casini2009" role="doc-biblioref">Casini et al. 2009</a>)</span>.</p>
<!-- The logistic equation $$ \frac{dN}{dt}=rN(1-\frac{N}{K}) $$ is nonlinear because the change in population of species N is not proportional to the current abundance of N: if N is half of the carrying capacity K, the population of N will be growing much faster than if N is very close to K. -->
<p>Empirical dynamic modeling (EDM) uses time series data to analyze and forecast nonlinear systems, which are extremely common in the natural world <span class="citation" data-cites="deyle2016">(<a href="#ref-deyle2016" role="doc-biblioref">E. R. Deyle, May, et al. 2016</a>)</span>. Ecologists classically model species interactions using a community matrix, a matrix of the partial derivatives (the Jacobian) of the system evaluated at equilibrium. The sign and magnitude of the coefficients in the matrix represent the direction and intensity, respectively, of the impact of a change in population of one species on the population of another. However, as with the Baltic Sea fish example, having a single matrix of coefficients does not suffice to describe a complex nonlinear system because the interaction between species can vary with the state of the ecosystem <span class="citation" data-cites="deyle2016">(<a href="#ref-deyle2016" role="doc-biblioref">E. R. Deyle, May, et al. 2016</a>)</span>. Methods based on linear regression to analyze nonlinear ecological systems, while extremely valuable, have many weaknesses, including the inability to distinguish interactions between species from the effect of a shared driving variable like temperature (see the <a href="https://en.wikipedia.org/wiki/Moran%27s_theorem">Moran Effect</a>).</p>
<blockquote class="blockquote">
<p>In EDM, the state of a dynamical system is a specific location in a multivariate coordinate space, or state space, whose coordinate axes are causally coupled ecosystem variables such as species abundance, temperature, resources, etc. The state of the system changes in time according to the rules/equations that describe the system dynamics, and this in turn traces out a trajectory. The collection of these time-series trajectories forms a geometric object called an attractor manifold, which describes empirically how variables relate to each other in time. <span class="citation" data-cites="deyle2016">(<a href="#ref-deyle2016" role="doc-biblioref">E. R. Deyle, May, et al. 2016</a>)</span></p>
</blockquote>
<p>Motion on the attractor manifold can be projected onto a coordinate axis, forming a time series. On the other hand, we can use time series data to reconstruct the dynamics of the system in multidimensional state space, called attractor reconstruction <span class="citation" data-cites="chang2017">(<a href="#ref-chang2017" role="doc-biblioref">Chang, Ushio, and Hsieh 2017</a>)</span>. In the real world, we often lack the necessary data (e.g., time series for cod, phytoplankton, and zooplankton) to reconstruct the dynamics of a system, and we likely do not even know all of the variables that dictate the state of the system. Using Takens’ theorem, we can use time-delay embedding to reconstruct a “shadow manifold” that preserves the essential dynamics of the original system.</p>
<p><a href="https://youtu.be/fevurdpiRYg">Introduction to Empirical Dynamic Modeling</a> (YouTube video)</p>
<p><a href="https://youtu.be/QQwtrWBwxQg">Constructing Empirical Dynamic Models: Takens’Theorem</a> (YouTube video)</p>
<section id="simplex-projection" class="level2">
<h2 class="anchored" data-anchor-id="simplex-projection">Simplex Projection</h2>
<p>Simplex projection is a non-parametric analysis in state space used to determine the optimal embedding dimension, <span class="math inline">\(E\)</span>, of a system. This is important for future EDM techniques and can offer insight into the dimensionality (and complexity) of a given system. Papers that provide helpful and more technically rigorous descriptions of simplex projection include <span class="citation" data-cites="ye2015">Ye, Beamish, et al. (<a href="#ref-ye2015" role="doc-biblioref">2015</a>)</span>, <span class="citation" data-cites="chang2017">Chang, Ushio, and Hsieh (<a href="#ref-chang2017" role="doc-biblioref">2017</a>)</span>, <span class="citation" data-cites="sugihara1990">Sugihara and May (<a href="#ref-sugihara1990" role="doc-biblioref">1990</a>)</span>, and the <a href="https://cran.r-project.org/web/packages/rEDM/vignettes/rEDM-tutorial.pdf">vignette</a> for the R package rEDM, which also describes how to perform the analysis in R. Roughly, simplex projection is done as follows:</p>
<ol type="1">
<li>Choose an embedding dimension, <span class="math inline">\(E\)</span></li>
<li>Use the <span class="math inline">\(E+1\)</span> nearest neighbors of the target point in <span class="math inline">\(E\)</span>-dimensional space to enclose the predictee in a minimal polygon (simplex)</li>
<li>Use the future position of the simplex to predict the future position of the predictee
<ul>
<li>Take the weighted average of the forward evolutions of the neighboring points (the average scaled by Euclidean distance of the nearest neighbor to the predictee)</li>
</ul></li>
<li>Evaluate the predictive skill of the simplex projection, such as by computing the correlation coefficient <span class="math inline">\(\rho\)</span> between the forecasted and observed results.</li>
<li>Repeat the process with different values of <span class="math inline">\(E\)</span> to determine which <span class="math inline">\(E\)</span> results in the highest predictive skill, indicating the optimal embedding dimension</li>
</ol>
<p>**NOTES **</p>
<ul>
<li><span class="math inline">\(E\)</span> is <em>not</em> necessarily the same as the true dimension of the system, <span class="math inline">\(D\)</span>, or the number of variables being analyzed (e.g., number of species in a trophic web), but it is bounded such that <span class="math inline">\(E&lt;2D+1\)</span></li>
<li>It is sometimes helpful to take the first differences in a target variable to distinguish meaningful prediction ability arising from the system dynamics from the statistical prediction resulting from autocorrelation. For example, <span class="citation" data-cites="deyle2018">E. Deyle et al. (<a href="#ref-deyle2018" role="doc-biblioref">2018</a>)</span> used <span class="math inline">\(ΔLPUE(t) = LPUE(t + 1) − LPUE(t)\)</span> rather than simply <span class="math inline">\(LPUE(t)\)</span>.</li>
</ul>
</section>
<section id="s-map-analysis" class="level2">
<h2 class="anchored" data-anchor-id="s-map-analysis">S-Map Analysis</h2>
<p>S-map analysis can be used to distinguish nonlinear dynamical systems from linear stochastic systems and identify the degree of state-dependency of a system <span class="citation" data-cites="sugihara1994">(<a href="#ref-sugihara1994" role="doc-biblioref">Sugihara 1994</a>)</span>.S-mapping is a forecasting method that uses locally weighted multivariate linear regressions calculated as the system moves along its attractor. Rather than using only nearby points, S-maps uses the entire library of points on the attractor, where points are given an exponentially decaying weight based on their distance from the target point.</p>
<p>Helpful explanations of how S-mapping works can be found in the Methods sections of <span class="citation" data-cites="glaser2011">(<a href="#ref-glaser2011" role="doc-biblioref">Glaser et al. 2011</a>)</span>,<span class="citation" data-cites="deyle2016">(<a href="#ref-deyle2016" role="doc-biblioref">E. R. Deyle, May, et al. 2016</a>)</span> and <span class="citation" data-cites="deyle2018">(<a href="#ref-deyle2018" role="doc-biblioref">E. Deyle et al. 2018</a>)</span>, as well as in <span class="citation" data-cites="chang2017">(<a href="#ref-chang2017" role="doc-biblioref">Chang, Ushio, and Hsieh 2017</a>)</span>.</p>
<blockquote class="blockquote">
<p>S-map analysis is a locally weighted linear regression performed under the state space associated with a weighting function in the form of an exponential decay kernel, <span class="math inline">\(w(d) = e^{(−θ d/\bar{d})}\)</span>. Here, <span class="math inline">\(d\)</span> is the distance between the predictee and each library point, and <span class="math inline">\(\bar{d}\)</span> is the mean distance of all paired library points. The parameter θ controls the degree of state dependency. If θ = 0, all library points have the same weight regardless of the local state of the predictee; mathematically, this model reduces to a linear autoregressive model. In contrast, if θ &gt; 0, the forecast given by the S-map depends on the local state of the predictee, and thus produces locally different fittings. Therefore, by comparing the performance of equivalent linear (θ = 0) and nonlinear (θ &gt; 0) S-map models, one can distinguish nonlinear dynamical systems from linear stochastic systems. <span class="citation" data-cites="chang2017">(<a href="#ref-chang2017" role="doc-biblioref">Chang, Ushio, and Hsieh 2017</a>)</span></p>
</blockquote>
<p>We can quantify the state-dependency of the system by finding the improvement in prediction skill of the nonlinear model compared to a linear model, <span class="math inline">\(Δ\rho=\rho_\theta-\rho_{(\theta=0)}\)</span>. The statistical significance of S-map results can be analyzed by generating a randomized version of the time series that maintains the fundamental statistical properties of the real data set (like autocorrelation), but is otherwise completely random. Performing S-map analysis on a large sample of such randomly-generated series will generate a null distribution of the S-map predictability <span class="math inline">\(\rho\)</span> and <span class="math inline">\(Δ\rho\)</span>. Thus, we can find the probability of obtaining the <span class="math inline">\(\rho\)</span> and <span class="math inline">\(Δ\rho\)</span> values from the real data if the underlying nonlinear dynamics were not present.</p>
</section>
<section id="convergent-cross-mapping-ccm" class="level2">
<h2 class="anchored" data-anchor-id="convergent-cross-mapping-ccm">Convergent Cross-Mapping (CCM)</h2>
<p><a href="https://youtu.be/NrFdIz-D2yM">State Space Reconstruction: Convergent Cross Mapping</a> (YouTube video)</p>
<p>CCM can detect causal linkages between time series and distinguish such causality from correlation arising from a shared environmental driver. <span class="citation" data-cites="sugihara2012">(<a href="#ref-sugihara2012" role="doc-biblioref">Sugihara et al. 2012</a>)</span> provides a comprehensive description of how CCM works, with general explanations also available in <span class="citation" data-cites="chang2017">(<a href="#ref-chang2017" role="doc-biblioref">Chang, Ushio, and Hsieh 2017</a>)</span>, <span class="citation" data-cites="ye2015a">(<a href="#ref-ye2015a" role="doc-biblioref">Ye, Deyle, et al. 2015</a>)</span>,<span class="citation" data-cites="deyle2013">(<a href="#ref-deyle2013" role="doc-biblioref">E. R. Deyle et al. 2013</a>)</span>, and <span class="citation" data-cites="deyle2018">(<a href="#ref-deyle2018" role="doc-biblioref">E. Deyle et al. 2018</a>)</span>, among others.</p>
<p>In essence, CCM measures the extent to which the historical record of <span class="math inline">\(Y\)</span>’s values (the shadow manifold <span class="math inline">\(M_Y\)</span> built from <span class="math inline">\(Y\)</span> and the appropriate number of time lags) can be used to predict states of <span class="math inline">\(X\)</span>. If <span class="math inline">\(X\)</span> causes <span class="math inline">\(Y\)</span>, information about the state of <span class="math inline">\(X\)</span> can be recovered from <span class="math inline">\(M_Y\)</span> and having a more detailed <span class="math inline">\(M_Y\)</span> (bigger library size = a denser manifold) increases the prediction skill of <span class="math inline">\(X\)</span>. Therefore, significant convergence when using <span class="math inline">\(M_Y\)</span> to predict <span class="math inline">\(X\)</span> (i.e., <span class="math inline">\(Y\)</span> crossmap <span class="math inline">\(X\)</span>) indicates causality in the reverse direction, <span class="math inline">\(X\Rightarrow Y\)</span>. For a stochastic forcing variable <span class="math inline">\(X\)</span>, the current state of <span class="math inline">\(Y\)</span> cannot be inferred from values of <span class="math inline">\(X\)</span>, so a manifold reconstructed from lags of <span class="math inline">\(X\)</span> will not reliably estimate <span class="math inline">\(Y\)</span>; i.e., <span class="math inline">\(X\)</span> crossmap <span class="math inline">\(Y\)</span> will fail to converge.</p>
<p>Here is a collection of papers that have used CCM to identify causality in complex ecosystems. (Note that papers incorporating spatial data into CCM are in the following section.)</p>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 29%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th>Author, year</th>
<th>Title</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="citation" data-cites="sugihara2012">Sugihara et al. (<a href="#ref-sugihara2012" role="doc-biblioref">2012</a>)</span></td>
<td>Detecting Causality in Complex Ecosystems</td>
<td>The must-read paper describing CCM! Describes different possibilities: bidirectional causality via functional coupling, unidirectional causality, and more complex models. Supplementary material is also helpful, esp.&nbsp;Box S1 (pg. 37). Examples included: (1) Bidirectional coupling b/w Didinium (predator) and Paramecium (prey), and (2) Anchovy, sardine, and SST: species aren’t coupled to each other, but weakly forced by same envi. driver</td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="deyle2013">E. R. Deyle et al. (<a href="#ref-deyle2013" role="doc-biblioref">2013</a>)</span></td>
<td>Predicting climate effects on Pacific sardine</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="citation" data-cites="ye2015a">Ye, Deyle, et al. (<a href="#ref-ye2015a" role="doc-biblioref">2015</a>)</span></td>
<td>Distinguishing time-delayed causal interactions using convergent cross mapping</td>
<td></td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="mcgowan2017">McGowan et al. (<a href="#ref-mcgowan2017" role="doc-biblioref">2017</a>)</span></td>
<td>Predicting coastal algal blooms in southern California</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="citation" data-cites="chang2017">Chang, Ushio, and Hsieh (<a href="#ref-chang2017" role="doc-biblioref">2017</a>)</span></td>
<td>Empirical dynamic modeling for beginners</td>
<td></td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="deyle2018">E. Deyle et al. (<a href="#ref-deyle2018" role="doc-biblioref">2018</a>)</span></td>
<td>Ecosystem-based forecasts of recruitment in two menhaden species</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="spatial-edm" class="level1">
<h1>Spatial EDM</h1>
<p>There are several different approaches to incorporating spatial dynamics into EDM.</p>
<p>Here is a collection of papers that have analyzed the spatio-temporal dynamics of a natural system using EDM:</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th>Author, year</th>
<th>Title</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="citation" data-cites="hsieh2008">Hsieh, Anderson, and Sugihara (<a href="#ref-hsieh2008" role="doc-biblioref">2008</a>)</span></td>
<td>Extending Nonlinear Analysis to Short Ecological Time Series</td>
<td>Combines ecologically similar multispecies time series into one long (composite) time series. Offers 3 tests to ensure accurate results and tests method with 23 Pacific coastal fish species</td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="glaser2011">Glaser et al. (<a href="#ref-glaser2011" role="doc-biblioref">2011</a>)</span></td>
<td>Detecting and forecasting complex nonlinear dynamics in spatially structured catch-per-unit-effort time series for North Pacific albacore</td>
<td>Uses spatially disaggregated data to increase info density, create composite time series, produce annual CPUE forecast at 2 different spatial scales. Figs. 4, 5 are a cool way of explaining simplex projection and S-maps. Standardizing CPUE removed signature of nonlinearity. Use of target-composite to forecast individual cells produced better forecasts than single cell analysis.</td>
</tr>
<tr class="odd">
<td><span class="citation" data-cites="clark2015">Clark et al. (<a href="#ref-clark2015" role="doc-biblioref">2015</a>)</span></td>
<td>Spatial convergent cross mapping to detect causal relationships from short time series</td>
<td></td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="mcnamara2019">McNamara et al. (<a href="#ref-mcnamara2019" role="doc-biblioref">2019</a>)</span></td>
<td>Insights into coral reef benthic dynamics from nonlinear spatial forecasting</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="citation" data-cites="brito-millán2019">Brito-Millán et al. (<a href="#ref-brito-millán2019" role="doc-biblioref">2019</a>)</span></td>
<td>Influence of aggregation on benthic coral reef spatio-temporal dynamics</td>
<td></td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="johnson2021">Johnson, Gomez, and Munch (<a href="#ref-johnson2021" role="doc-biblioref">2021</a>)</span></td>
<td>Leveraging spatial information to forecast nonlinear ecological dynamics</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="other-edm-papers" class="level1">
<h1>Other EDM papers</h1>
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 54%">
</colgroup>
<thead>
<tr class="header">
<th>Author, year</th>
<th>Title</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="citation" data-cites="dixon1999">Dixon, Milicich, and Sugihara (<a href="#ref-dixon1999" role="doc-biblioref">1999</a>)</span></td>
<td>Episodic Fluctuations in Larval Supply</td>
<td>Concluded variation in recruitment arises from nonlinear response of larval reef fish to key physical forcing variables. Used S-maps to show predictability of egg production and recruitment didn’t improve with increasing nonlinearity, but larval supply did. Modeled larval supply based on 3 biological drivers, concluded fluctuations result from both deterministic (lunar) and stochastic (wind stress) variables</td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="hsieh2005">Hsieh et al. (<a href="#ref-hsieh2005" role="doc-biblioref">2005</a>)</span></td>
<td>Distinguishing random environmental fluctuations from ecological catastrophes for the North Pacific Ocean</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="citation" data-cites="royer2006">Royer and Fromentin (<a href="#ref-royer2006" role="doc-biblioref">2006</a>)</span></td>
<td>Recurrent and density-dependent patterns in long-term fluctuations of Atlantic bluefin tuna trap catches</td>
<td>Helpful explanation of generating surrogates with white or red noise as a null hypotheses to test for determinism. Uses recurrence analysis rather than EDM: similar (uses lagged coordinate embedding) but uses fitting instead of prediction/forecasting and provides qual. rather than quant. info about nonlinearity</td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="anderson2008">Anderson et al. (<a href="#ref-anderson2008" role="doc-biblioref">2008</a>)</span></td>
<td>Why fishing magnifies fluctuations in fish abundance</td>
<td>Tests three different hypothesis about relationship b/w fishing and stock variability, uses S-maps to find that age-truncated pops have increasingly unstable pop dynamics bc of changing demographic parameters, not bc of variable fishing pressure or more closely tracking environmental variation</td>
</tr>
<tr class="odd">
<td><span class="citation" data-cites="tsonis2015">Tsonis et al. (<a href="#ref-tsonis2015" role="doc-biblioref">2015</a>)</span></td>
<td>Dynamical evidence for causality between galactic cosmic rays and interannual variation in global temperature</td>
<td>Also see <span class="citation" data-cites="ye2015b">Ye, Sugihara, et al. (<a href="#ref-ye2015b" role="doc-biblioref">2015</a>)</span></td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="deyle2016a">E. R. Deyle, Maher, et al. (<a href="#ref-deyle2016a" role="doc-biblioref">2016</a>)</span></td>
<td>Global environmental drivers of influenza</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="citation" data-cites="li2021">Li et al. (<a href="#ref-li2021" role="doc-biblioref">2021</a>)</span></td>
<td>Beyond linearity, stability, and equilibrium: The edm package for empirical dynamic modeling and convergent cross-mapping in Stata</td>
<td></td>
</tr>
<tr class="even">
<td><span class="citation" data-cites="munch2023">Munch, Rogers, and Sugihara (<a href="#ref-munch2023" role="doc-biblioref">2023</a>)</span></td>
<td>Recent developments in empirical dynamic modelling</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="references" class="level1">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-anderson2008" class="csl-entry" role="listitem">
Anderson, Christian N. K., Chih-hao Hsieh, Stuart A. Sandin, Roger Hewitt, Anne Hollowed, John Beddington, Robert M. May, and George Sugihara. 2008. <span>“Why Fishing Magnifies Fluctuations in Fish Abundance.”</span> <em>Nature</em> 452 (7189): 835–39. <a href="https://doi.org/10.1038/nature06851">https://doi.org/10.1038/nature06851</a>.
</div>
<div id="ref-brito-millán2019" class="csl-entry" role="listitem">
Brito-Millán, Marlene, B. T. Werner, Stuart A. Sandin, and Dylan E. McNamara. 2019. <span>“Influence of Aggregation on Benthic Coral Reef Spatio-Temporal Dynamics.”</span> <em>Royal Society Open Science</em> 6 (2): 181703. <a href="https://doi.org/10.1098/rsos.181703">https://doi.org/10.1098/rsos.181703</a>.
</div>
<div id="ref-casini2009" class="csl-entry" role="listitem">
Casini, Michele, Joakim Hjelm, Juan-Carlos Molinero, Johan Lövgren, Massimiliano Cardinale, Valerio Bartolino, Andrea Belgrano, and Georgs Kornilovs. 2009. <span>“Trophic Cascades Promote Threshold-Like Shifts in Pelagic Marine Ecosystems.”</span> <em>Proceedings of the National Academy of Sciences</em> 106 (1): 197–202. <a href="https://doi.org/10.1073/pnas.0806649105">https://doi.org/10.1073/pnas.0806649105</a>.
</div>
<div id="ref-chang2017" class="csl-entry" role="listitem">
Chang, Chun-Wei, Masayuki Ushio, and Chih-hao Hsieh. 2017. <span>“Empirical Dynamic Modeling for Beginners.”</span> <em>Ecological Research</em> 32 (6): 785–96. <a href="https://doi.org/10.1007/s11284-017-1469-9">https://doi.org/10.1007/s11284-017-1469-9</a>.
</div>
<div id="ref-clark2015" class="csl-entry" role="listitem">
Clark, Adam Thomas, Hao Ye, Forest Isbell, Ethan R. Deyle, Jane Cowles, G. David Tilman, and George Sugihara. 2015. <span>“Spatial Convergent Cross Mapping to Detect Causal Relationships from Short Time Series.”</span> <em>Ecology</em> 96 (5): 1174–81. <a href="https://doi.org/10.1890/14-1479.1">https://doi.org/10.1890/14-1479.1</a>.
</div>
<div id="ref-deyle2013" class="csl-entry" role="listitem">
Deyle, Ethan R., Michael Fogarty, Chih-hao Hsieh, Les Kaufman, Alec D. MacCall, Stephan B. Munch, Charles T. Perretti, Hao Ye, and George Sugihara. 2013. <span>“Predicting Climate Effects on Pacific Sardine.”</span> <em>Proceedings of the National Academy of Sciences</em> 110 (16): 6430–35. <a href="https://doi.org/10.1073/pnas.1215506110">https://doi.org/10.1073/pnas.1215506110</a>.
</div>
<div id="ref-deyle2016a" class="csl-entry" role="listitem">
Deyle, Ethan R., M. Cyrus Maher, Ryan D. Hernandez, Sanjay Basu, and George Sugihara. 2016. <span>“Global Environmental Drivers of Influenza.”</span> <em>Proceedings of the National Academy of Sciences</em> 113 (46): 13081–86. <a href="https://doi.org/10.1073/pnas.1607747113">https://doi.org/10.1073/pnas.1607747113</a>.
</div>
<div id="ref-deyle2016" class="csl-entry" role="listitem">
Deyle, Ethan R., Robert M. May, Stephan B. Munch, and George Sugihara. 2016. <span>“Tracking and Forecasting Ecosystem Interactions in Real Time.”</span> <em>Proceedings of the Royal Society B: Biological Sciences</em> 283 (1822): 20152258. <a href="https://doi.org/10.1098/rspb.2015.2258">https://doi.org/10.1098/rspb.2015.2258</a>.
</div>
<div id="ref-deyle2018" class="csl-entry" role="listitem">
Deyle, Ethan, Amy M Schueller, Hao Ye, Gerald M Pao, and George Sugihara. 2018. <span>“Ecosystem-Based Forecasts of Recruitment in Two Menhaden Species.”</span> <em>Fish and Fisheries</em> 19 (5): 769–81. <a href="https://doi.org/10.1111/faf.12287">https://doi.org/10.1111/faf.12287</a>.
</div>
<div id="ref-dixon1999" class="csl-entry" role="listitem">
Dixon, Paul A., Maria J. Milicich, and George Sugihara. 1999. <span>“Episodic Fluctuations in Larval Supply.”</span> <em>Science</em> 283 (5407): 1528–30. <a href="https://doi.org/10.1126/science.283.5407.1528">https://doi.org/10.1126/science.283.5407.1528</a>.
</div>
<div id="ref-glaser2011" class="csl-entry" role="listitem">
Glaser, Sarah M., Hao Ye, Mark Maunder, Alec MacCall, Michael Fogarty, and George Sugihara. 2011. <span>“Detecting and Forecasting Complex Nonlinear Dynamics in Spatially Structured Catch-Per-Unit-Effort Time Series for North Pacific Albacore (Thunnus Alalunga).”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 68 (3): 400–412. <a href="https://doi.org/10.1139/F10-160">https://doi.org/10.1139/F10-160</a>.
</div>
<div id="ref-hsieh2008" class="csl-entry" role="listitem">
Hsieh, Chih-hao, Christian Anderson, and George Sugihara. 2008. <span>“Extending Nonlinear Analysis to Short Ecological Time Series.”</span> <em>The American Naturalist</em> 171 (1): 71–80. <a href="https://doi.org/10.1086/524202">https://doi.org/10.1086/524202</a>.
</div>
<div id="ref-hsieh2005" class="csl-entry" role="listitem">
Hsieh, Chih-hao, Sarah M. Glaser, Andrew J. Lucas, and George Sugihara. 2005. <span>“Distinguishing Random Environmental Fluctuations from Ecological Catastrophes for the North Pacific Ocean.”</span> <em>Nature</em> 435 (7040): 336–40. <a href="https://doi.org/10.1038/nature03553">https://doi.org/10.1038/nature03553</a>.
</div>
<div id="ref-johnson2021" class="csl-entry" role="listitem">
Johnson, Bethany, Marcella Gomez, and Stephan B. Munch. 2021. <span>“Leveraging Spatial Information to Forecast Nonlinear Ecological Dynamics.”</span> <em>Methods in Ecology and Evolution</em> 12 (2): 266–79. <a href="https://doi.org/10.1111/2041-210X.13511">https://doi.org/10.1111/2041-210X.13511</a>.
</div>
<div id="ref-li2021" class="csl-entry" role="listitem">
Li, Jinjing, Michael J. Zyphur, George Sugihara, and Patrick J. Laub. 2021. <span>“Beyond Linearity, Stability, and Equilibrium: The Edm Package for Empirical Dynamic Modeling and Convergent Cross-Mapping in Stata.”</span> <em>The Stata Journal</em> 21 (1): 220–58. <a href="https://doi.org/10.1177/1536867X211000030">https://doi.org/10.1177/1536867X211000030</a>.
</div>
<div id="ref-mcgowan2017" class="csl-entry" role="listitem">
McGowan, John A., Ethan R. Deyle, Hao Ye, Melissa L. Carter, Charles T. Perretti, Kerri D. Seger, Alain de Verneil, and George Sugihara. 2017. <span>“Predicting Coastal Algal Blooms in Southern California.”</span> <em>Ecology</em> 98 (5): 1419–33. <a href="https://doi.org/10.1002/ecy.1804">https://doi.org/10.1002/ecy.1804</a>.
</div>
<div id="ref-mcnamara2019" class="csl-entry" role="listitem">
McNamara, Dylan E., Nick Cortale, Clinton Edwards, Yoan Eynaud, and Stuart A. Sandin. 2019. <span>“Insights into Coral Reef Benthic Dynamics from Nonlinear Spatial Forecasting.”</span> <em>Journal of The Royal Society Interface</em> 16 (153): 20190047. <a href="https://doi.org/10.1098/rsif.2019.0047">https://doi.org/10.1098/rsif.2019.0047</a>.
</div>
<div id="ref-munch2023" class="csl-entry" role="listitem">
Munch, Stephan B., Tanya L. Rogers, and George Sugihara. 2023. <span>“Recent Developments in Empirical Dynamic Modelling.”</span> <em>Methods in Ecology and Evolution</em> 14 (3): 732–45. <a href="https://doi.org/10.1111/2041-210X.13983">https://doi.org/10.1111/2041-210X.13983</a>.
</div>
<div id="ref-royer2006" class="csl-entry" role="listitem">
Royer, F., and J. M. Fromentin. 2006. <span>“Recurrent and Density-Dependent Patterns in Long-Term Fluctuations of Atlantic Bluefin Tuna Trap Catches.”</span> <em>Marine Ecology Progress Series</em> 319 (August): 237–49. <a href="https://doi.org/10.3354/meps319237">https://doi.org/10.3354/meps319237</a>.
</div>
<div id="ref-sayama2015" class="csl-entry" role="listitem">
Sayama, Hiroki. 2015. <em>Introduction to the modeling and analysis of complex systems</em>. Open SUNY textbooks. Albany: SUNY Geneseo. <a href="https://math.libretexts.org/Bookshelves/Scientific_Computing_Simulations_and_Modeling/Book%3A_Introduction_to_the_Modeling_and_Analysis_of_Complex_Systems_(Sayama)">https://math.libretexts.org/Bookshelves/Scientific_Computing_Simulations_and_Modeling/Book%3A_Introduction_to_the_Modeling_and_Analysis_of_Complex_Systems_(Sayama)</a>.
</div>
<div id="ref-sugihara1994" class="csl-entry" role="listitem">
Sugihara, George. 1994. <span>“Nonlinear Forecasting for the Classification of Natural Time Series.”</span> <em>Philosophical Transactions of the Royal Society of London. Series A: Physical and Engineering Sciences</em> 348 (1688): 477–95. <a href="https://doi.org/10.1098/rsta.1994.0106">https://doi.org/10.1098/rsta.1994.0106</a>.
</div>
<div id="ref-sugihara1990" class="csl-entry" role="listitem">
Sugihara, George, and Robert M. May. 1990. <span>“Nonlinear Forecasting as a Way of Distinguishing Chaos from Measurement Error in Time Series.”</span> <em>Nature</em> 344 (6268): 734–41. <a href="https://doi.org/10.1038/344734a0">https://doi.org/10.1038/344734a0</a>.
</div>
<div id="ref-sugihara2012" class="csl-entry" role="listitem">
Sugihara, George, Robert May, Hao Ye, Chih-hao Hsieh, Ethan Deyle, Michael Fogarty, and Stephan Munch. 2012. <span>“Detecting Causality in Complex Ecosystems.”</span> <em>Science</em> 338 (6106): 496–500. <a href="https://doi.org/10.1126/science.1227079">https://doi.org/10.1126/science.1227079</a>.
</div>
<div id="ref-tsonis2015" class="csl-entry" role="listitem">
Tsonis, Anastasios A., Ethan R. Deyle, Robert M. May, George Sugihara, Kyle Swanson, Joshua D. Verbeten, and Geli Wang. 2015. <span>“Dynamical Evidence for Causality Between Galactic Cosmic Rays and Interannual Variation in Global Temperature.”</span> <em>Proceedings of the National Academy of Sciences</em> 112 (11): 3253–56. <a href="https://doi.org/10.1073/pnas.1420291112">https://doi.org/10.1073/pnas.1420291112</a>.
</div>
<div id="ref-ye2015" class="csl-entry" role="listitem">
Ye, Hao, Richard J. Beamish, Sarah M. Glaser, Sue C. H. Grant, Chih-hao Hsieh, Laura J. Richards, Jon T. Schnute, and George Sugihara. 2015. <span>“Equation-Free Mechanistic Ecosystem Forecasting Using Empirical Dynamic Modeling.”</span> <em>Proceedings of the National Academy of Sciences</em> 112 (13). <a href="https://doi.org/10.1073/pnas.1417063112">https://doi.org/10.1073/pnas.1417063112</a>.
</div>
<div id="ref-ye2015a" class="csl-entry" role="listitem">
Ye, Hao, Ethan R. Deyle, Luis J. Gilarranz, and George Sugihara. 2015. <span>“Distinguishing Time-Delayed Causal Interactions Using Convergent Cross Mapping.”</span> <em>Scientific Reports</em> 5 (1). <a href="https://doi.org/10.1038/srep14750">https://doi.org/10.1038/srep14750</a>.
</div>
<div id="ref-ye2015b" class="csl-entry" role="listitem">
Ye, Hao, George Sugihara, Ethan R. Deyle, Robert M. May, Kyle Swanson, and Anastasios A. Tsonis. 2015. <span>“Reply to Luo Et Al.: Robustness of Causal Effects of Galactic Cosmic Rays on Interannual Variation in Global Temperature.”</span> <em>Proceedings of the National Academy of Sciences</em> 112 (34). <a href="https://doi.org/10.1073/pnas.1511080112">https://doi.org/10.1073/pnas.1511080112</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>