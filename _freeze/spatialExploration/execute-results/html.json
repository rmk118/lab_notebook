{
  "hash": "ad38784607d802104bf21232574a3f7b",
  "result": {
    "markdown": "---\ntitle: 'Spatial Exploration'\ndate: '2023-06-27'\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: console\nbibliography: references.bib\n---\n\n\n# Spatial data exploration\n\nRuby Krasnow\n\nLast modified: June 24, 2023\n\nLoad packages\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(NEFSCspatial)\nlibrary(tidyverse)\n```\n:::\n\n\nSMAST scallop data (HabCam)\n\n::: {.cell}\n\n```{.r .cell-code}\n# SMAST Scallop data-----------------------------------------------------------------\n# The data I want, but averaged across years\n\nst_layers(\"data/SMAST_SCALLOP/SMAST_Scallops.gdb\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDriver: OpenFileGDB \nAvailable layers:\n                layer_name geometry_type features fields crs_name\n1 AveragePresenceAbundance Multi Polygon      920     32    NAD83\n```\n:::\n\n```{.r .cell-code}\ntest<- st_read(\"data/SMAST_SCALLOP/SMAST_Scallops.gdb\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `AveragePresenceAbundance' from data source \n  `/Users/rubykrasnow/Downloads/lab_notebook/data/SMAST_SCALLOP/SMAST_Scallops.gdb' \n  using driver `OpenFileGDB'\nSimple feature collection with 920 features and 32 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -75.14375 ymin: 36.39138 xmax: -66.32867 ymax: 42.49109\nGeodetic CRS:  NAD83\n```\n:::\n\n```{.r .cell-code}\n# class(test)\nprint(test[1:15], n = 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 920 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -75.14375 ymin: 36.39138 xmax: -66.32867 ymax: 42.49109\nGeodetic CRS:  NAD83\nFirst 3 features:\n  F100km_Id F1000Km_Id AreaKm Stations DepthAve ScallopAve SeaStarAve  CrabAve\n1      1024         28    100        2    20.00       0.00        4.5 0.000000\n2      1097         28    100        4    20.85       0.75        4.0 0.000000\n3      1098         28    100        3    18.50       0.00        5.0 0.333333\n  HerCrabAve SandDolAve BryHydAve HolesAve MnSnailAve SpongeAve FlatFishAv\n1          0          0         0                             0          0\n2          0          0         0                             0          0\n3          0          0         0                             0          0\n                           Shape\n1 MULTIPOLYGON (((-75.02578 3...\n2 MULTIPOLYGON (((-74.91487 3...\n3 MULTIPOLYGON (((-74.9217 36...\n```\n:::\n\n```{.r .cell-code}\npar(mar = c(0,0,1,0))\nplot(test[6])\n```\n\n::: {.cell-output-display}\n![](spatialExploration_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nNEFSC scallop survey data: time series, but doesn't include predation info\n\n::: {.cell}\n\n```{.r .cell-code}\n# NEFSC scallop survey data - through 2015 -----------------------------------------------------------------\n\nst_layers(\"~/Downloads/Fish/Fish.gdb\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDriver: OpenFileGDB \nAvailable layers:\n                                                layer_name geometry_type\n1                                EFH_Overlay_Final_Jan2015 Multi Polygon\n2                         HighlyMigratorySpeciesEFHOverlay Multi Polygon\n3                                           ScallopBiomass         Point\n4          SeaScallops2016_2018PotentialReproductiveOutput Multi Polygon\n5 fras_aux_SeaScallops2016_2018PotentialReproductiveOutput            NA\n6 fras_blk_SeaScallops2016_2018PotentialReproductiveOutput            NA\n7 fras_bnd_SeaScallops2016_2018PotentialReproductiveOutput            NA\n8 fras_ras_SeaScallops2016_2018PotentialReproductiveOutput            NA\n9      vat_SeaScallops2016_2018PotentialReproductiveOutput            NA\n  features fields                 crs_name\n1     1713     44 WGS 84 / Pseudo-Mercator\n2    42474     45                    NAD83\n3    16057      8                    NAD83\n4        1      3                   WGS 84\n5        2      3                     <NA>\n6       63      6                     <NA>\n7        1     18                     <NA>\n8        1      3                     <NA>\n9        3      2                     <NA>\n```\n:::\n\n```{.r .cell-code}\nfish<- st_read(\"~/Downloads/Fish/Fish.gdb\", layer=\"ScallopBiomass\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `ScallopBiomass' from data source \n  `/Users/rubykrasnow/Downloads/Fish/Fish.gdb' using driver `OpenFileGDB'\nSimple feature collection with 16057 features and 8 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -75.63333 ymin: 35.55 xmax: -65.916 ymax: 42.16667\nGeodetic CRS:  NAD83\n```\n:::\n\n```{.r .cell-code}\n# st_geometry(fish)\n# class(fish)\n\npar(mar = c(0,0,1,0))\nplot(fish[6])\n```\n\n::: {.cell-output-display}\n![](spatialExploration_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfish<- fish %>% \n  filter(year_ > 1966) %>% \n  mutate(YEAR = year_, .keep = \"unused\") %>%\n  na.omit()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# NEFSC Spatial package - maps of shellfish strata -----------------------------------------------------------------\nscallops<-NEFSCspatial::Shellfish_Strata\nplot(scallops)\n```\n\n::: {.cell-output-display}\n![](spatialExploration_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\ntestGIS <-st_read(\"~/Downloads/lab_notebook/data/Scallop_Rotational_Areas_20230419/Scallop_Rotational_Areas_20230411.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `Scallop_Rotational_Areas_20230411' from data source \n  `/Users/rubykrasnow/Downloads/lab_notebook/data/Scallop_Rotational_Areas_20230419/Scallop_Rotational_Areas_20230411.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 6 features and 23 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -8274749 ymin: 4602998 xmax: -7333888 ymax: 5087139\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n:::\n\n```{.r .cell-code}\nplot(testGIS[\"AREANAME\"], main=\"Scallop Management Areas\")\n```\n\n::: {.cell-output-display}\n![](spatialExploration_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\ntestGB <- testGIS %>% \n  filter(GARFO_ID != \"G000610\" & GARFO_ID != \"G000611\") %>% \n  select(AREANAME, GARFO_ID, CFRPARA, FRCITE, FRDATE, SOURCE, COMMNAME, geometry) %>% \n  mutate(NAME = recode(AREANAME, \"Area I Scallop Rotational Area\" = \"Area_I\", \n                       \"Area II Scallop Rotational Area\" = \"Area_II\", \n                       \"Nantucket Lightship North Scallop Rotational Area\" = \"NL_N\",\n                       \"Nantucket Lightship West Scallop Rotational Area\" = \"NL_W\"))\n\n\nplot(testGB[\"NAME\"], main=\"Georges Bank Scallop Management Areas\", key.pos=1, key.width = 0.1, key.length = 0.9)\n```\n\n::: {.cell-output-display}\n![](spatialExploration_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\nTesting and adjusting CRS:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Adjust CRS of the map of protected areas to match scallop survey CRS\n# st_crs(fish) - NAD83 (EPSG:4269)\n# st_crs(testGB) - WGS 84 / Pseudo-Mercator (EPSG: 3857)\ntestGB2<- st_transform(testGB, crs = \"EPSG:4269\")\nst_crs(testGB2) # now they are both NAD83\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCoordinate Reference System:\n  User input: EPSG:4269 \n  wkt:\nGEOGCRS[\"NAD83\",\n    DATUM[\"North American Datum 1983\",\n        ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    USAGE[\n        SCOPE[\"Geodesy.\"],\n        AREA[\"North America - onshore and offshore: Canada - Alberta; British Columbia; Manitoba; New Brunswick; Newfoundland and Labrador; Northwest Territories; Nova Scotia; Nunavut; Ontario; Prince Edward Island; Quebec; Saskatchewan; Yukon. Puerto Rico. United States (USA) - Alabama; Alaska; Arizona; Arkansas; California; Colorado; Connecticut; Delaware; Florida; Georgia; Hawaii; Idaho; Illinois; Indiana; Iowa; Kansas; Kentucky; Louisiana; Maine; Maryland; Massachusetts; Michigan; Minnesota; Mississippi; Missouri; Montana; Nebraska; Nevada; New Hampshire; New Jersey; New Mexico; New York; North Carolina; North Dakota; Ohio; Oklahoma; Oregon; Pennsylvania; Rhode Island; South Carolina; South Dakota; Tennessee; Texas; Utah; Vermont; Virginia; Washington; West Virginia; Wisconsin; Wyoming. US Virgin Islands. British Virgin Islands.\"],\n        BBOX[14.92,167.65,86.45,-40.73]],\n    ID[\"EPSG\",4269]]\n```\n:::\n:::\n\n\nMapping together:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map of points within polygons\nggplot() + geom_sf(data = testGB2) + geom_sf(data = fish)\n```\n\n::: {.cell-output-display}\n![](spatialExploration_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Intersection (first polygon, then points)\ninter <- st_intersects(testGB2, fish)\n\n# Add point count to each polygon\ntestGB2$count <- lengths(inter)\n\n# Map of number of points within polygons\nggplot(testGB2) + geom_sf(aes(fill = count))\n```\n\n::: {.cell-output-display}\n![](spatialExploration_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n",
    "supporting": [
      "spatialExploration_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}