{
  "hash": "fa390dff0ab8c0e419de35dae5726df2",
  "result": {
    "markdown": "---\ntitle: 'Week 4'\ndate: '2023-07-02'\ncategories: ['Week 4', 'Data exploration', 'NEFMC meeting']\ndescription: 'My activities for the week'\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: console\nbibliography: references.bib\n---\n\n\n## Monday, June 26 (+ preceding weekend)\n\n1.  I worked some more with the NEFSC spatial package, specifically focusing on isolating the areas that would contain the stations of interest:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(NEFSCspatial)\nlibrary(tidyverse)\n\nscallops<-NEFSCspatial::Shellfish_Strata\nplot(scallops)\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\ntestGIS<-st_read(\"~/Downloads/lab_notebook/data/Scallop_Rotational_Areas_20230419/Scallop_Rotational_Areas_20230411.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `Scallop_Rotational_Areas_20230411' from data source \n  `/Users/rubykrasnow/Downloads/lab_notebook/data/Scallop_Rotational_Areas_20230419/Scallop_Rotational_Areas_20230411.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 6 features and 23 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -8274749 ymin: 4602998 xmax: -7333888 ymax: 5087139\nProjected CRS: WGS 84 / Pseudo-Mercator\n```\n:::\n\n```{.r .cell-code}\nplot(testGIS[\"AREANAME\"], main=\"Scallop Management Areas\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n\n```{.r .cell-code}\ntestGB <- testGIS %>% \n  filter(GARFO_ID != \"G000610\" & GARFO_ID != \"G000611\") %>% \n  select(AREANAME, GARFO_ID, CFRPARA, FRCITE, FRDATE, SOURCE, COMMNAME, geometry) %>% \n  mutate(NAME = recode(AREANAME, \"Area I Scallop Rotational Area\" = \"Area_I\", \"Area II Scallop Rotational Area\" = \"Area_II\", \"Nantucket Lightship North Scallop Rotational Area\" = \"NL_N\",\"Nantucket Lightship West Scallop Rotational Area\" = \"NL_W\"))\n\nplot(testGB[\"NAME\"], main=\"Georges Bank Scallop Management Areas\", key.pos=1, key.width = 0.1, key.length = 0.9)\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-1-3.png){width=672}\n:::\n:::\n\n\n2.  Scallop/starfish data wrangling\n3.  Multivariate CCM examples (see below)\n4.  Dr. Deyle invited Josue and I to attend an interesting talk by a professor from Princeton on applications of data science and machine learning in urban planning.\n\n## Tuesday, June 27\n\n1.  NEFMC Meeting Day 1\n\nInteresting but non-scallop-specific links:\n\n-   [New England and Mid-Atlantic Geographic Strategic Plan 2020-2023](https://d23h0vhsm26o6d.cloudfront.net/5b_NOAA_NE_MidA_SP.Update.pdf)\n-   [National Data Buoy Presentation](https://d23h0vhsm26o6d.cloudfront.net/5a_Final-NATIONAL-DATA-BUOY-CENTER-Pr.pdf)\n-   [Atlantic States Marine Fisheries Commission 2023 Spring Meeting Summary](https://d23h0vhsm26o6d.cloudfront.net/3_2023SpringMeetingSummary.pdf)\n-   [NEFMC Program Review Recommendations Tracking Sheet](https://d23h0vhsm26o6d.cloudfront.net/1B_Prog_Rev_Tracking_NEFMC_June_Mtg_Working_2023-06-20-130743_wazt.pdf)\n-   [U.S. Fishery Management and Conservation Areas web map](https://www.arcgis.com/home/item.html?id=0f5946eb61be4d899b88ac3916bb7691)\n-   [National Standard 1 Technical Guidance for Reference Points and Status Determinations](https://www.nefmc.org/library/june-2023-national-standard-1-technical-guidance-for-reference-points-and-status-determinations)\n-   About the stock assessment process\n    -  [Management and Research Track Stock Assessment Timelines](https://d23h0vhsm26o6d.cloudfront.net/Timeline-light-2.pdf)\n\n    -  [Description of New England and Mid-Atlantic Region Stock Assessment Process](https://d23h0vhsm26o6d.cloudfront.net/NRCC_Assessment_Process_Version-18Feb2022_508.pdf)\n\n2.    BRITE programming workshop: Git and Snakemake\n3.    Continued organizing and visualizing the scallop and predator data\n  -   R packages I am using frequently for all of my data exploration, analysis, and visualization include: tidyverse (dplyr, ggplot2, tibble, purrr, stringr, forcats, readr, and tidyr), ggplotify, patchwork, lubridate, mgcv, rEDM, multispatialEDM, nlme, sf, sfheaders, and the NEFSC packages I mentioned earlier. \n\n## Wednesday, June 28\n\n1.  NEFMC Meeting Day 2\n    1.  Most of the day had a heavy focus on [groundfish](https://www.nefmc.org/library/june-2023-groundfish-committee-report) (haddock, cod), but interesting discussions regarding setting Acceptable Biological Catch limits (ABCs), determining FMSY, how to consider Canadian catch limits and fishing pressure on the stock, etc.\n    2.  Interesting [Potential Action Menu](https://d23h0vhsm26o6d.cloudfront.net/11a_ECSP-Potential-Action-Menu-16-June-2023.pdf) and [Summit Report](https://d23h0vhsm26o6d.cloudfront.net/11b_ECSPSummitReport_April2023.pdf) from the East Coast Climate Change Scenario Planning Initiative\n2.  BRITE workshop: Managing setbacks and redefining success\n3.  Spatial analysis of Georges Bank scallop data (see the [exploring.R](https://github.com/rmk118/lab_notebook/blob/main/exploring.R) and [spatial.R](https://github.com/rmk118/lab_notebook/blob/main/spatial.R) files stored on my GitHub)\n\n## Thursday, June 29\n\n1.  NEFMC Meeting Day 3 - EBFM (Ecosystem-Based Fisheries Management) and Scallop Presentations\n2.  Continued spatial analysis of Georges Bank scallop data\n3.  Meeting with Dr. Dvora Hart, Operations Research Analyst at the Northeast Fisheries Science Center (and lead assessment scientist for Atlantic sea scallops fishery). Dr. Deyle and Dr. Kaufman also attended. We had an excellent discussion about both the broad direction of my project and technical details relating to how to best develop accurate models of the system. She will send me more data documenting scallop and scallop predator (starfish and crab) abundances, with instructions on how to process the data so it is suitable for quantitative analysis.\n\n## Friday, June 30\n\nToday I worked with the Maine inshore trawl survey data that I got access to yesterday afternoon. On the GitHub page for my lab notebook, you can find the raw data in the folder \"data/Maine_inshore_trawl\", and the R scripts containing the most up-to-date version of my data exploration/analysis are in the \"Maine\" folder.\n\n## Multispatial CCM practice\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Multispatial CCM package vignette\n#Ruby Krasnow\n#Last modified: 6/26/2023\n\nlibrary(multispatialCCM)\nlibrary(patchwork)\n\n\n# Example data ------------------------------------------------------------\n\n#Simulate data to use for multispatial CCM test\n#See function for details - A is causally forced by B,\n#but the reverse is not true.\nccm_data_out<-make_ccm_data()\n\nAccm<-ccm_data_out$Accm\nBccm<-ccm_data_out$Bccm\n#Calculate optimal E\nmaxE<-5 #Maximum E to test\n#Matrix for storing output\nEmat<-matrix(nrow=maxE-1, ncol=2); colnames(Emat)<-c(\"A\", \"B\")\n\n#Loop over potential E values and calculate predictive ability\n#of each process for its own dynamics\nfor(E in 2:maxE) {\n  #Uses defaults of looking forward one prediction step (predstep)\n  #And using time lag intervals of one time step (tau)\n  Emat[E-1,\"A\"]<-SSR_pred_boot(A=Accm, E=E, predstep=1, tau=1)$rho\n  Emat[E-1,\"B\"]<-SSR_pred_boot(A=Bccm, E=E, predstep=1, tau=1)$rho\n}\n\n#Look at plots to find E for each process at which\n#predictive ability rho is maximized\nmatplot(2:maxE, Emat, type=\"l\", col=1:2, lty=1:2,\n        xlab=\"E\", ylab=\"rho\", lwd=2)\nlegend(\"bottomleft\", c(\"A\", \"B\"), lty=1:2, col=1:2, lwd=2, bty=\"n\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nE_A<-2\nE_B<-3\n\n#Check data for nonlinear signal that is not dominated by noise\n#Checks whether predictive ability of processes declines with\n#increasing time distance\n#See manuscript and R code for details\nsignal_A_out<-SSR_check_signal(A=Accm, E=E_A, tau=1,\n                               predsteplist=1:10)\nsignal_B_out<-SSR_check_signal(A=Bccm, E=E_B, tau=1,\n                               predsteplist=1:10)\n\nplot(signal_A_out$predatout)\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#Run the CCM test\n#E_A and E_B are the embedding dimensions for A and B.\n#tau is the length of time steps used (default is 1)\n#iterations is the number of bootstrap iterations (default 100)\n# Does A \"cause\" B?\n#Note - increase iterations to 100 for consistent results\nCCM_boot_A<-CCM_boot(Accm, Bccm, E_A, tau=1, iterations=10)\n# Does B \"cause\" A?\nCCM_boot_B<-CCM_boot(Bccm, Accm, E_B, tau=1, iterations=10)\n\n#Test for significant causal signal\n#See R function for details\n(CCM_significance_test<-ccmtest(CCM_boot_A,\n                                CCM_boot_B))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\npval_a_cause_b pval_b_cause_a \n           0.3            0.0 \n```\n:::\n\n```{.r .cell-code}\n#Plot results\nplotxlimits<-range(c(CCM_boot_A$Lobs, CCM_boot_B$Lobs))\n#Plot \"A causes B\"\nplot(CCM_boot_A$Lobs, CCM_boot_A$rho, type=\"l\", col=1, lwd=2,\n     xlim=c(plotxlimits[1], plotxlimits[2]), ylim=c(0,1),\n     xlab=\"L\", ylab=\"rho\")\n#Add +/- 1 standard error\nmatlines(CCM_boot_A$Lobs,\n         cbind(CCM_boot_A$rho-CCM_boot_A$sdevrho,\n               CCM_boot_A$rho+CCM_boot_A$sdevrho),\n         lty=3, col=1)\n#Plot \"B causes A\"\nlines(CCM_boot_B$Lobs, CCM_boot_B$rho, type=\"l\", col=2, lty=2, lwd=2)\n#Add +/- 1 standard error\nmatlines(CCM_boot_B$Lobs,\n         cbind(CCM_boot_B$rho-CCM_boot_B$sdevrho,\n               CCM_boot_B$rho+CCM_boot_B$sdevrho),\n         lty=3, col=2)\nlegend(\"topleft\",\n       c(\"A causes B\", \"B causes A\"),\n       lty=c(1,2), col=c(1,2), lwd=2, bty=\"n\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# Nitrogen E001 unfertilized -----------------------------------------------------------\n\ne0010<- read.csv(\"~/Downloads/lab_notebook/example_code/multispatialCCMexamples/e001_arssnlvl0.csv\")\n\ne0010test<- e0010 %>% \n  group_by(FieldPlot) %>% \n  summarise(years=n_distinct(Year))\n\n#Remove the isolated 2008 years and the extra NA rows that result\ne0010 <- e0010 %>% \n  filter(is.na(Year)|Year != 2008)\nfor (i in 1:(nrow(e0010)-1)) {\n  if (!is.na(e0010[i,\"Year\"]) | !is.na(e0010[i+1,\"Year\"])) {\n    e0010<-e0010\n  }\n  else {\n    e0010<-e0010 %>%slice(-i)\n  }\n}\n\nrepens <- e0010$Agropyron.repens\nscop <- e0010$Schizachyrium.scoparium\n\n#Calculate optimal E\nmaxE2<-20 #Maximum E to test\n#Matrix for storing output\nEmat2<-matrix(nrow=maxE2-1, ncol=2); colnames(Emat2)<-c(\"A. repens\", \"S. scoparium\")\n\nfor(E in 2:maxE2) {\n  #Uses defaults of looking forward one prediction step (predstep)\n  #And using time lag intervals of one time step (tau)\n  Emat2[E-1,\"A. repens\"]<-SSR_pred_boot(A=repens, E=E, predstep=1, tau=1)$rho\n  Emat2[E-1,\"S. scoparium\"]<-SSR_pred_boot(A=scop, E=E, predstep=1, tau=1)$rho\n}\n\n#predictive skill by embedding dimension\nmatplot(2:maxE2, Emat2, type=\"l\", col=1:2, lty=1:2,\n        xlab=\"E\", ylab=\"rho\", lwd=2)\nlegend(\"bottomleft\", c(\"A. repens\", \"S. scoparium\"), lty=1:2, col=1:2, lwd=2, bty=\"n\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-4.png){width=672}\n:::\n\n```{.r .cell-code}\nE_repens<-5\nE_scop<-16\n\n#Check data for nonlinear signal that is not dominated by noise\n#Checks whether predictive ability of processes declines with increasing time distance\nsignal_rep_out<-SSR_check_signal(A=repens, E=E_repens, tau=1,\n                               predsteplist=1:25)\nsignal_scop_out<-SSR_check_signal(A=scop, E=E_scop, tau=1,\n                               predsteplist=1:25)\n\nplot(signal_rep_out$predatout, type=\"l\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-5.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(signal_scop_out$predatout, type=\"l\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-6.png){width=672}\n:::\n\n```{.r .cell-code}\n# Nitrogen E001 fertilized -----------------------------------------------------------\ne0013<- read.csv(\"~/Downloads/lab_notebook/example_code/multispatialCCMexamples/e001_arssnlvl3.csv\")\n\ne0013test<- e0013 %>% \n  group_by(FieldPlot) %>% \n  summarise(years=n_distinct(Year))\n\ne0013 <- e0013 %>% \n  filter(is.na(Year)|Year != 2008)\nfor (i in 1:(nrow(e0013)-1)) {\n  if (!is.na(e0013[i,\"Year\"]) | !is.na(e0013[i+1,\"Year\"])) {\n    e0013<-e0013\n  }\n  else {\n    e0013<-e0013 %>%slice(-i)\n  }\n}\n\nrepens3 <- e0013$Agropyron.repens\nscop3 <- e0013$Schizachyrium.scoparium\n\n#Calculate optimal E\nmaxE3<-20 #Maximum E to test\n#Matrix for storing output\nEmat3<-matrix(nrow=maxE3-1, ncol=2); colnames(Emat3)<-c(\"A. repens\", \"S. scoparium\")\n\nfor(E in 2:maxE3) {\n  #Uses defaults of looking forward one prediction step (predstep)\n  #And using time lag intervals of one time step (tau)\n  Emat3[E-1,\"A. repens\"]<-SSR_pred_boot(A=repens3, E=E, predstep=1, tau=1)$rho\n  Emat3[E-1,\"S. scoparium\"]<-SSR_pred_boot(A=scop3, E=E, predstep=1, tau=1)$rho\n}\n\n#predictive skill by embedding dimension\nmatplot(2:maxE3, Emat3, type=\"l\", col=1:2, lty=1:2,\n        xlab=\"E\", ylab=\"rho\", lwd=2)\nlegend(\"bottomleft\", c(\"A. repens\", \"S. scoparium\"), lty=1:2, col=1:2, lwd=2, bty=\"n\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-7.png){width=672}\n:::\n\n```{.r .cell-code}\nE_repens3<-12\nE_scop3<-3\n\n#Check data for nonlinear signal that is not dominated by noise\n#Checks whether predictive ability of processes declines with increasing time distance\nsignal_rep3_out<-SSR_check_signal(A=repens, E=E_repens3, tau=1,\n                                 predsteplist=1:25)\nsignal_scop3_out<-SSR_check_signal(A=scop, E=E_scop3, tau=1,\n                                  predsteplist=1:25)\n\nplot(signal_rep3_out$predatout, type=\"l\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-8.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(signal_scop_out$predatout, type=\"l\")\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-9.png){width=672}\n:::\n\n```{.r .cell-code}\n#Creating time-lagged plot in 2 dimensions (i.e. A. repens population this year, vs. next year)\nlagRepens <- e0013 %>%\n  mutate(lagR = 0) %>% \n  group_by(FieldPlot) %>% \n  select(Year, FieldPlot, Agropyron.repens, lagR) %>% \n  na.omit()\n\ndata_mod <- lagRepens %>%                           \n  group_by(FieldPlot) %>%\n  dplyr::mutate(laggedval = lag(Agropyron.repens, n = 1, default = NA))\n\nplotA<- ggplot(data_mod, aes(x=Agropyron.repens, y=laggedval, color=Year))+geom_point()+ scale_color_gradientn(colours = rainbow(30))+theme_classic()+labs(x=\"t0\", y=\"t1\")\n\n#Creating time-lagged plot in 2 dimensions (i.e. S. scoparium population this year, vs. next year)\nlagScop <- e0013 %>%\n  mutate(lagS = 0) %>% \n  group_by(FieldPlot) %>% \n  select(Year, FieldPlot, Schizachyrium.scoparium, lagS) %>% \n  na.omit()\n\ndata_modS <- lagScop %>%                           \n  group_by(FieldPlot) %>%\n  dplyr::mutate(laggedvalS = lag(Schizachyrium.scoparium, n = 1, default = NA))\n\nplotS<- ggplot(data_modS, aes(x=Schizachyrium.scoparium, y=laggedvalS, color=Year))+geom_point()+ scale_color_gradientn(colours = rainbow(30))+theme_classic()+labs(x=\"t0\", y=\"t1\")\n\n#Recreated figure A6!\nplotA+plotS +  plot_layout(guides = 'collect')\n```\n\n::: {.cell-output-display}\n![](Week4_files/figure-html/unnamed-chunk-2-10.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Week4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}