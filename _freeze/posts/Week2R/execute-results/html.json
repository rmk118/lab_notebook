{
  "hash": "8699866cc93c08d6827da5c7ce6a66f7",
  "result": {
    "markdown": "---\ntitle: 'Week 2 in R'\ndate: '2023-06-16'\ncategories: ['Week 2', 'R']\ndescription: 'My activities for the week'\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: console\n---\n\n\nNote: I continually refined my code, so some of the older or now-unnecessary code cells below are set to \"eval = FALSE\" so that the code will still be visible but will not be evaluated and disrupt the output of later cells.\n\n## Monday, June 12\n\n**All set to eval = FALSE**\n\nLoad packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n:::\n\n\nLooking at 22564_UNION_FSCS_SVCAT (one out of five .csv files in the folder shared by Dr. Deyle)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read data\nsvcat <- read.csv(\"~/Downloads/lab_notebook/data/22564_UNION_FSCS_SVCAT.csv\")\n\n#view the first six rows of data\nhead(svcat)\n\n#different overviews of the data\nsummary(svcat)\nglimpse(svcat)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#filter to only species of interest - reduces it from 94632 observations to 21425\nscallops <- svcat %>% \n  filter(SCIENTIFIC_NAME==\"Placopecten magellanicus (sea scallop)\" | \n           SCIENTIFIC_NAME ==\"Placopecten magellanicus (sea scallop clapper)\")\n\nscallops <- scallops %>% \n  mutate(name = SCIENTIFIC_NAME,\n         cruise6 = as.factor(CRUISE6),\n         cruise = as.factor(CRUISE),\n         sex = as.factor(CATCHSEX),\n         stratum = as.factor(STRATUM),\n         .keep = \"unused\")\n\nsummary(scallops)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nscallops <- scallops %>% \n  mutate(name = recode(name, \"Placopecten magellanicus (sea scallop)\" = \"scallop\", \"Placopecten magellanicus (sea scallop clapper)\" = \"clapper\"))\n\nsummarise_all(scallops,n_distinct)\n\n#All have sex = 0, which means \"Unsexed, unknown, or sex not observed\"\n#SVSPP is species, listed as either 401 (scallop) or 400 (clapper), redundant info to species\n\n#Remove unnecessary variables\nscallops <- scallops %>% \n  select(-c(\"sex\", \"STATUS_CODE\", \"SVSPP\"))\n\n#ggplot(scallops, aes(x = cruise)) + geom_bar()\n#ggplot(scallops, aes(x = cruise6)) + geom_bar()\n#ggplot(scallops, aes(x = stratum)) + geom_bar()\n```\n:::\n\n\n# Tuesday and Wednesday (June 13 and 14)\n\nLoad packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) #rather than importing separately\n```\n:::\n\n\nSet-up (from June 12)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read data\nsvcat <- read.csv(\"~/Downloads/lab_notebook/data/Old/22564_UNION_FSCS_SVCAT.csv\")\n\n#filter to only species of interest - reduces it from 94632 observations to 21425\nscallops <- svcat %>% \n  filter(SCIENTIFIC_NAME==\"Placopecten magellanicus (sea scallop)\" | \n           SCIENTIFIC_NAME ==\"Placopecten magellanicus (sea scallop clapper)\")\n\n#turn categorical variables into factors\nscallops <- scallops %>% \n  mutate(name = SCIENTIFIC_NAME,\n         CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         CATCHSEX = as.factor(CATCHSEX),\n         STRATUM = as.factor(STRATUM),\n         .keep = \"unused\")\n\n#shorten for clarity\nscallops <- scallops %>% \n  mutate(name = recode(name, \"Placopecten magellanicus (sea scallop)\" = \"scallop\", \n                       \"Placopecten magellanicus (sea scallop clapper)\" = \"clapper\"))\n\n#Remove unnecessary/redundant variables: all entries are listed as unknown sex (sex=0), \n# all have the same status code (10), and SVSPP corresponds with name (401 = scallop, \n# 400 = clappers)\nscallops <- scallops %>% \n  select(-c(\"CATCHSEX\", \"STATUS_CODE\", \"SVSPP\"))\n```\n:::\n\n\nI worked on turning the data into an actual time series:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read the file that has the season and year associated with each cruise\ncruises <- read.csv(\"~/Downloads/lab_notebook/data/Old/22564_SVDBS_CRUISES.csv\")\n\n#select the relevant variables\ncruises <- cruises %>% \n  select(c(\"CRUISE6\",\"SEASON\",\"YEAR\")) %>% \n  mutate(CRUISE6 = as.factor(CRUISE6), .keep=\"unused\")\n\n#combine with the existing dataframe\nscallops <- left_join(scallops, cruises, by=\"CRUISE6\")\n\nas_tibble(scallops)\n```\n:::\n\n\n# Thursday (June 15)\n\nLoad packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\n```\n:::\n\n\nDr. Deyle sent me some example code for wrangling lobster data from the NEFSC trawl surveys. I adapted the code for use with the scallop dredge surveys:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#read the file that has the metadata associated with each stratum and station\ndf_strata <- read.csv(\"~/Downloads/lab_notebook/data/Old/SVDBS_SVMSTRATA.csv\")\ndf_stations <- read.csv(\"~/Downloads/lab_notebook/data/Old/22564_UNION_FSCS_SVSTA.csv\")\n\n#standardizing the date formats\ndf_stations_wrangled <- df_stations %>%\n  mutate(DATE = lubridate::parse_date_time(BEGIN_EST_TOWDATE,orders=\"mdYHMS\",truncated = 3)) %>%\n  select(STATION,STRATUM,DATE) %>% #select relevant columns\n  mutate(DATE=lubridate::year(DATE)) %>%\n  distinct() #remove duplicate rows\n```\n:::\n\n\nThen, I wanted to get a general idea of how many times each station and stratum were in the data (i.e., how many years that station or stratum was sampled).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#shows how many occurrences of each station are in the data (i.e. how many years that station was sampled)\ndata.frame(table(df_stations_wrangled$STATION))\ndata.frame(table(df_stations_wrangled$STRATUM))\n```\n:::\n\n\nThis revealed that 20 rows had no station recorded. Additionally, many rows had text of some sort rather than a station or stratum number recorded in the corresponding column (e.g., \"took 20-30 meters\" and \"STARFISH NO STARS\").\n\nI then checked to see how many entries were present for each year:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(table(df_stations_wrangled$DATE))\n```\n:::\n\n\nImportantly, this revealed that the dates for stations only go up to 2006, plus a few observations in 2015 and 2021. At first, I thought that this meant there was only scallop data until 2006, and that this dataset didn't include the SMAST drop camera and WHOI/HabCam data that has been collected since around 2003 as part of the NEFSC scallop survey. The example code for wrangling lobster data relies on the fact that each lobster observation is associated with a station, so I assumed (incorrectly) that the scallop data would be the same.\n\nUnfortunately, this prompted me to spend much of the afternoon searching for the camera data, until I eventually realized that only having stations until 2006 did not mean there was only scallop data until 2006. Checking the entries per year for the scallop data rather than the stations revealed that there was in fact scallop data from 1977 through 2021.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata.frame(table(scallops$YEAR))\n```\n:::\n\n\nHowever, searching for the camera data was not a complete waste of time. In my search, I had re-pulled the NOAA Scallop Survey data and found that this newer version had data through 2022, whereas the version that Dr. Deyle shared with me only extended to 2021. See the \"Week 2 in Words\" page for more about what I found in my search for the post-2006 scallop data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#re-run setup for new data\nsvcatNew <- read.csv(\"~/Downloads/lab_notebook/data/22564_UNION_FSCS_SVCAT2022.csv\")\n\nscallopsNew <- svcatNew %>% \n  filter(SCIENTIFIC_NAME==\"Placopecten magellanicus (sea scallop)\" | \n           SCIENTIFIC_NAME ==\"Placopecten magellanicus (sea scallop clapper)\")\n\n#turn categorical variables into factors\nscallopsNew <- scallopsNew %>% \n  mutate(name = SCIENTIFIC_NAME,\n         CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         CATCHSEX = as.factor(CATCHSEX),\n       #  STRATUM = as.factor(STRATUM), <-- this became unnecessary later\n         .keep = \"unused\")\n\n#shorten for clarity\nscallopsNew <- scallopsNew %>% \n  mutate(name = recode(name, \"Placopecten magellanicus (sea scallop)\" = \"scallop\", \n                       \"Placopecten magellanicus (sea scallop clapper)\" = \"clapper\")) %>% \n select(-c(\"CATCHSEX\", \"STATUS_CODE\", \"SVSPP\"))\n\n#read the file that has the season and year associated with each cruise\ncruisesNew <- read.csv(\"~/Downloads/lab_notebook/data/22564_SVDBS_CRUISES2022.csv\")\n\n#select the relevant variables\ncruisesNew <- cruisesNew %>% \n  select(c(\"CRUISE6\",\"SEASON\",\"YEAR\")) %>% \n  mutate(CRUISE6 = as.factor(CRUISE6), .keep=\"unused\")\n\n#combine with the existing dataframe\nscallopsNew <- left_join(scallopsNew, cruisesNew, by=\"CRUISE6\")\n\nas_tibble(scallopsNew)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 21,581 × 12\n   CRUISE6 CRUISE STRATUM   TOW STATION ID         EXPCA…¹ EXPCA…² CATCH…³ name \n   <fct>   <fct>  <chr>   <int>   <int> <chr>        <int>   <dbl> <chr>   <chr>\n 1 197703  177    06370       1       1 197703063…       4     0.3 \"\"      scal…\n 2 197703  177    06370       2       2 197703063…       3     0.1 \"\"      scal…\n 3 197703  177    06370       3       3 197703063…       2     0.3 \"\"      scal…\n 4 197703  177    06380       1       4 197703063…       4     0.9 \"\"      scal…\n 5 197703  177    06370       4       5 197703063…      12     1.7 \"\"      scal…\n 6 197703  177    06370       5       6 197703063…      22     4.6 \"\"      scal…\n 7 197703  177    06420       1       8 197703064…       1     0.1 \"\"      scal…\n 8 197703  177    06500       1      13 197703065…       2     0.3 \"\"      scal…\n 9 197703  177    06500       2      14 197703065…       7     0   \"\"      clap…\n10 197703  177    06500       2      14 197703065…    1897   154.  \"\"      scal…\n# … with 21,571 more rows, 2 more variables: SEASON <chr>, YEAR <int>, and\n#   abbreviated variable names ¹​EXPCATCHNUM, ²​EXPCATCHWT, ³​CATCH_COMMENT\n```\n:::\n\n```{.r .cell-code}\ndata.frame(table(scallopsNew$YEAR))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Var1 Freq\n1  1977  346\n2  1978  429\n3  1979  335\n4  1980  425\n5  1981  304\n6  1982  425\n7  1983  568\n8  1984  651\n9  1985  512\n10 1986  471\n11 1987  614\n12 1988  656\n13 1989  503\n14 1990  580\n15 1991  583\n16 1992  490\n17 1993  531\n18 1994  519\n19 1995  548\n20 1996  477\n21 1997  527\n22 1998  606\n23 1999  443\n24 2000  539\n25 2001  675\n26 2002  685\n27 2003  681\n28 2004  828\n29 2005  748\n30 2006  765\n31 2007  805\n32 2008  639\n33 2009  590\n34 2010  680\n35 2011  426\n36 2012  315\n37 2013  247\n38 2014  175\n39 2015  242\n40 2016  191\n41 2017  168\n42 2018  212\n43 2019  163\n44 2021  108\n45 2022  156\n```\n:::\n:::\n\n\nI then started to organize the scallop data for analysis:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#this gets rid of some weird strata in 1984 with letters, which don't seem to \n# correspond to any of the NOAA (shellfish, dredge, or trawl survey) strata\nscallopsTest <-  scallopsNew %>%\n  mutate(STRATUM = as.integer(STRATUM)) %>% \n  filter(!is.na(STRATUM))\n\n#This will show you which ones were removed\n# scallopsTest <-  scallopsNew %>%\n#   mutate(strat = as.integer(STRATUM)) %>% \n#   filter(is.na(strat))\n\ndf_strataNew <- read.csv(\"~/Downloads/lab_notebook/data/newSVDBS_SVMSTRATA.csv\")\n\n#shows how many occurrences of each stratum are in the data (i.e. how many years that stratum was sampled)\ndata.frame(table(scallopsNew$STRATUM))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Var1 Freq\n1   01160   15\n2   0116A    5\n3   0121A    5\n4   01260    9\n5   01270   38\n6   01370   45\n7   0137A    7\n8   01380   20\n9   03580    1\n10  03590   11\n11  06010    5\n12  06020    9\n13  06030   11\n14  06040    6\n15  06050    7\n16  06060  141\n17  06070  118\n18  06080    8\n19  06090   53\n20  06100  330\n21  06110  493\n22  06120   25\n23  06130   51\n24  06140  570\n25  06150  766\n26  06160   54\n27  06170   71\n28  06180  656\n29  06190  712\n30  06200   19\n31  06210  113\n32  06220  447\n33  06230 1104\n34  06240  194\n35  06250  215\n36  06260  466\n37  06270  840\n38  06280  178\n39  06290  233\n40  06300  579\n41  06310 1050\n42  06320   36\n43  06330  267\n44  06340  431\n45  06350  197\n46  06360    1\n47  06370   40\n48  06380   58\n49  06390   14\n50  06400    2\n51  06410   16\n52  06420    5\n53  06440    3\n54  06450   10\n55  06460  247\n56  06470  789\n57  06480   27\n58  06490  396\n59  06500  880\n60  0650G   16\n61  06510  618\n62  06520  666\n63  06530  530\n64  06540  549\n65  06550  382\n66  06560   15\n67  06570   29\n68  06580  208\n69  06590  442\n70  0659F    2\n71  06600  437\n72  0660F   33\n73  06610  488\n74  06620   52\n75  06621  687\n76  06622  133\n77  06630   38\n78  06631   78\n79  06632  118\n80  06640  507\n81  0664B    6\n82  0664D   13\n83  0664E   12\n84  06650   60\n85  06651  476\n86  06652  321\n87  0665E    4\n88  06660   79\n89  06661  495\n90  06662  220\n91  0666A   11\n92  06670   10\n93  06680    2\n94  06700    1\n95  06710  521\n96  0671C    5\n97  06720   96\n98  06730   11\n99  06740   96\n100 06990   15\n```\n:::\n\n```{.r .cell-code}\n#the key matching strata to location (latitude and longitude) starts from 1010\nscallopsNew <-  scallopsNew %>%\n  filter(STRATUM > 1000)\n```\n:::\n\n\n# Friday (June 16)\n\nContinuing from yesterday:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Turns out all shellfish strata start with 6, any of the others were not consistently sampled\nscallopsNew <-  scallopsNew %>%\n  filter(STRATUM > 5999)\n\n#See how many years each stratum was sampled\nscallopsTest <- scallopsNew %>% \n  group_by(STRATUM) %>% \n  summarise(years=n_distinct(YEAR))\n\nscallopsTest\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 0 × 2\n# … with 2 variables: STRATUM <chr>, years <int>\n```\n:::\n:::\n\n\nAfter learning some GIS basics, I started working with some data sets I found online in hopes of getting the SMAST data, which has time series of scallop abundance alongside the abundance of major scallop predators. ([This survey, which is still ongoing](http://www.repstraus.com/wp-content/uploads/2015/03/SMAST-drop-cam-survey-1999-2014-Stokesbury.pdf).)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sf)\n\n# SMAST abundance survey downloaded from \ntest <- st_read(\"~/Downloads/lab_notebook/data/SMAST_SCALLOP/SMAST_Scallops.gdb\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `AveragePresenceAbundance' from data source \n  `/Users/rubykrasnow/Downloads/lab_notebook/data/SMAST_SCALLOP/SMAST_Scallops.gdb' \n  using driver `OpenFileGDB'\nSimple feature collection with 920 features and 32 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -75.14375 ymin: 36.39138 xmax: -66.32867 ymax: 42.49109\nGeodetic CRS:  NAD83\n```\n:::\n\n```{.r .cell-code}\nclass(test)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"sf\"         \"data.frame\"\n```\n:::\n\n```{.r .cell-code}\nattr(test, \"sf_column\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Shape\"\n```\n:::\n\n```{.r .cell-code}\nprint(test[9:15], n = 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 920 features and 7 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -75.14375 ymin: 36.39138 xmax: -66.32867 ymax: 42.49109\nGeodetic CRS:  NAD83\nFirst 3 features:\n  HerCrabAve SandDolAve BryHydAve HolesAve MnSnailAve SpongeAve FlatFishAv\n1          0          0         0                             0          0\n2          0          0         0                             0          0\n3          0          0         0                             0          0\n                           Shape\n1 MULTIPOLYGON (((-75.02578 3...\n2 MULTIPOLYGON (((-74.91487 3...\n3 MULTIPOLYGON (((-74.9217 36...\n```\n:::\n\n```{.r .cell-code}\nst_geometry(test)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeometry set for 920 features \nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -75.14375 ymin: 36.39138 xmax: -66.32867 ymax: 42.49109\nGeodetic CRS:  NAD83\nFirst 5 geometries:\n```\n:::\n\n```{.r .cell-code}\npar(mar = c(0,0,1,0))\nplot(test[6])\n```\n\n::: {.cell-output-display}\n![](Week2R_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\nI also found a version of the NEFSC scallops survey in spatial form and started exploring that dataset:\n\n::: {.cell}\n\n```{.r .cell-code}\nfish <- st_read(\"~/Downloads/Fish/Fish.gdb\", layer=\"ScallopBiomass\")\nst_layers(\"~/Downloads/Fish/Fish.gdb\")\nattr(fish, \"sf_column\")\nst_geometry(fish)\nclass(fish)\n\npar(mar = c(0,0,1,0))\nplot(fish[6])\n```\n:::",
    "supporting": [
      "Week2R_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}