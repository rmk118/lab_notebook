{
  "hash": "9c75f0839b1a132fc81020e5843aa9eb",
  "result": {
    "markdown": "---\ntitle: 'Exploring'\ndate-modified: '2023-06-17'\ncategories: ['Resources']\ndescription: 'Clean summary of code so far.'\nexecute: \n  message: false\n  warning: false\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n#Summary of data analysis thus far\n#Last updated: June 17, 2023\n\nlibrary(tidyverse)\nlibrary(lubridate)\n\ndat_len<- read.csv(\"data/22564_UNION_FSCS_SVLEN2022.csv\")\ndat_cat <- read.csv(\"data/22564_UNION_FSCS_SVCAT2022.csv\")\ndat_bio <- read.csv(\"data/22564_UNION_FSCS_SVBIO2022.csv\", quote = \"\")\ncruises <- read.csv(\"data/22564_SVDBS_CRUISES2022.csv\")\ndf_stations <- read.csv(\"data/22564_UNION_FSCS_SVSTA2022.csv\")\ndf_strata <- read.csv(\"data/newSVDBS_SVMSTRATA.csv\")\n\n# Cruises & stations ---------------------------------------------------- \n\ncruises <- cruises %>%\n  select(c(\"CRUISE6\",\"SEASON\",\"YEAR\")) %>%\n  mutate(CRUISE6 = as.factor(CRUISE6), .keep=\"unused\")\n\ndf_stations <- df_stations %>% \n  mutate(STATION = as.numeric(STATION), YEAR = EST_YEAR) %>% \n  select(c(\"CRUISE6\",\"CRUISE\",\"STRATUM\", \"TOW\",\"STATION\",\"ID\",\"AREA\",\"SVVESSEL\",\"SVGEAR\",\n     \"BEGIN_EST_TOWDATE\",\"YEAR\",\"SETDEPTH\", \"AVGDEPTH\", \"BEGLAT\", \"BEGLON\"))\n\ndf_stations <- df_stations %>% \n  mutate(BEGIN_EST_TOWDATE = lubridate::dmy(BEGIN_EST_TOWDATE)) %>% \n  mutate(YEAR = year(BEGIN_EST_TOWDATE)) %>% \n  mutate(TOW = as.integer(TOW))\n\n# Length ------------------------------------------------------------------\n\nhead(dat_len)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CRUISE6 CRUISE STRATUM TOW STATION STATUS_CODE                 ID SVSPP\n1  197703    177   06370   1       1          10 197703063700010001   401\n2  197703    177   06370   1       1          10 197703063700010001   401\n3  197703    177   06370   1       1          10 197703063700010001   401\n4  197703    177   06370   1       1          10 197703063700010001   401\n5  197703    177   06370   2       2          10 197703063700020002   401\n6  197703    177   06370   2       2          10 197703063700020002   401\n  CATCHSEX LENGTH EXPNUMLEN                        SCIENTIFIC_NAME\n1        0    6.7         1 Placopecten magellanicus (sea scallop)\n2        0    8.3         1 Placopecten magellanicus (sea scallop)\n3        0    8.7         1 Placopecten magellanicus (sea scallop)\n4        0   10.3         1 Placopecten magellanicus (sea scallop)\n5        0    5.7         1 Placopecten magellanicus (sea scallop)\n6        0    6.7         2 Placopecten magellanicus (sea scallop)\n  LENGTH_COMMENT\n1               \n2               \n3               \n4               \n5               \n6               \n```\n:::\n\n```{.r .cell-code}\nstr(dat_len) #543666 observations of 13 vars\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t543666 obs. of  13 variables:\n $ CRUISE6        : int  197703 197703 197703 197703 197703 197703 197703 197703 197703 197703 ...\n $ CRUISE         : int  177 177 177 177 177 177 177 177 177 177 ...\n $ STRATUM        : chr  \"06370\" \"06370\" \"06370\" \"06370\" ...\n $ TOW            : int  1 1 1 1 2 2 3 3 1 1 ...\n $ STATION        : int  1 1 1 1 2 2 3 3 4 4 ...\n $ STATUS_CODE    : int  10 10 10 10 10 10 10 10 10 10 ...\n $ ID             : chr  \"197703063700010001\" \"197703063700010001\" \"197703063700010001\" \"197703063700010001\" ...\n $ SVSPP          : int  401 401 401 401 401 401 401 401 401 401 ...\n $ CATCHSEX       : int  0 0 0 0 0 0 0 0 0 0 ...\n $ LENGTH         : num  6.7 8.3 8.7 10.3 5.7 6.7 9.7 10.7 10.3 11.7 ...\n $ EXPNUMLEN      : int  1 1 1 1 1 2 1 1 1 1 ...\n $ SCIENTIFIC_NAME: chr  \"Placopecten magellanicus (sea scallop)\" \"Placopecten magellanicus (sea scallop)\" \"Placopecten magellanicus (sea scallop)\" \"Placopecten magellanicus (sea scallop)\" ...\n $ LENGTH_COMMENT : chr  \"\" \"\" \"\" \"\" ...\n```\n:::\n\n```{.r .cell-code}\nscallopLen <- dat_len %>%\n  filter(SCIENTIFIC_NAME == \"Placopecten magellanicus (sea scallop)\") %>% \n     mutate(NAME = recode(SCIENTIFIC_NAME, \"Placopecten magellanicus (sea scallop)\" = \"scallop\")) #shorten for readability\n                           \n#If interested in clappers also:\n# SCIENTIFIC_NAME == \"Placopecten magellanicus (sea scallop clapper)\") %>%  #filter to only scallops\n# recode(SCIENTIFIC_NAME, \"Placopecten magellanicus (sea scallop clapper)\" = \"clapper\")\n      \n#All have sex = 0, means sex unknown/not recorded\n#SVSPP is species, either 401 (scallop) or 400 (clapper), redundant to name column\n#So we can remove unnecessary variables\n\nscallopLen <- scallopLen %>% \n  select(-c(\"CATCHSEX\", \"STATUS_CODE\", \"SVSPP\", \"SCIENTIFIC_NAME\"))\n\nscallopLen <- scallopLen %>%\n  mutate(CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         STATION = as.numeric(STATION),\n         .keep = \"unused\")\n\nsummarise_all(scallopLen,n_distinct)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CRUISE6 CRUISE STRATUM TOW STATION    ID LENGTH EXPNUMLEN LENGTH_COMMENT NAME\n1      47     49     100 138     692 15629   1638      1127              1    1\n```\n:::\n\n```{.r .cell-code}\nscallopLen <- left_join(scallopLen, cruises, by=\"CRUISE6\")\n\nscallopLen <- scallopLen %>%\n  mutate(YEAR = as.numeric(YEAR)) %>%\n  filter(as.numeric(STRATUM) > 5999) #shellfish strata start with 6\n\nlen <- left_join(scallopLen, df_stations)\n\n# Catch ----------------------------------------------------------\n\nscallopCat <- dat_cat %>%\n  filter(SCIENTIFIC_NAME == \"Placopecten magellanicus (sea scallop)\") %>% \n  mutate(NAME = recode(SCIENTIFIC_NAME, \"Placopecten magellanicus (sea scallop)\" = \"scallop\"))\n\nscallopCat <- scallopCat %>% \n  select(-c(\"CATCHSEX\", \"STATUS_CODE\", \"SVSPP\", \"SCIENTIFIC_NAME\"))\n\nsummarise_all(scallopLen,n_distinct)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CRUISE6 CRUISE STRATUM TOW STATION    ID LENGTH EXPNUMLEN LENGTH_COMMENT NAME\n1      47     49      81 138     628 15430   1638      1119              1    1\n  SEASON YEAR\n1      3   45\n```\n:::\n\n```{.r .cell-code}\nscallopCat <- scallopCat %>%\n  mutate(CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         STATION = as.numeric(STATION),\n         .keep = \"unused\")\n\nscallopCat <- left_join(scallopCat, cruises, by=\"CRUISE6\")\n\n#shellfish strata start with 6\n scallopCat <-  scallopCat %>%\n   filter(as.numeric(STRATUM) > 5999)\n\nstr(scallopCat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t15433 obs. of  12 variables:\n $ CRUISE6      : Factor w/ 47 levels \"197703\",\"197708\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ CRUISE       : Factor w/ 49 levels \"177\",\"200107\",..: 1 1 1 1 1 1 1 1 1 1 ...\n $ STRATUM      : chr  \"06370\" \"06370\" \"06370\" \"06380\" ...\n $ TOW          : int  1 2 3 1 4 5 1 1 2 1 ...\n $ STATION      : num  1 2 3 4 5 6 8 13 14 15 ...\n $ ID           : chr  \"197703063700010001\" \"197703063700020002\" \"197703063700030003\" \"197703063800010004\" ...\n $ EXPCATCHNUM  : int  4 3 2 4 12 22 1 2 1897 22 ...\n $ EXPCATCHWT   : num  0.3 0.1 0.3 0.9 1.7 ...\n $ CATCH_COMMENT: chr  \"\" \"\" \"\" \"\" ...\n $ NAME         : chr  \"scallop\" \"scallop\" \"scallop\" \"scallop\" ...\n $ SEASON       : chr  \"SPRING\" \"SPRING\" \"SPRING\" \"SPRING\" ...\n $ YEAR         : int  1977 1977 1977 1977 1977 1977 1977 1977 1977 1977 ...\n```\n:::\n\n```{.r .cell-code}\nsummarise_all(scallopCat,n_distinct)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  CRUISE6 CRUISE STRATUM TOW STATION    ID EXPCATCHNUM EXPCATCHWT CATCH_COMMENT\n1      47     49      81 138     628 15433        2035       4923           202\n  NAME SEASON YEAR\n1    1      3   45\n```\n:::\n\n```{.r .cell-code}\nas_tibble(scallopCat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 15,433 × 12\n   CRUISE6 CRUISE STRATUM   TOW STATION ID         EXPCA…¹ EXPCA…² CATCH…³ NAME \n   <fct>   <fct>  <chr>   <int>   <dbl> <chr>        <int>   <dbl> <chr>   <chr>\n 1 197703  177    06370       1       1 197703063…       4     0.3 \"\"      scal…\n 2 197703  177    06370       2       2 197703063…       3     0.1 \"\"      scal…\n 3 197703  177    06370       3       3 197703063…       2     0.3 \"\"      scal…\n 4 197703  177    06380       1       4 197703063…       4     0.9 \"\"      scal…\n 5 197703  177    06370       4       5 197703063…      12     1.7 \"\"      scal…\n 6 197703  177    06370       5       6 197703063…      22     4.6 \"\"      scal…\n 7 197703  177    06420       1       8 197703064…       1     0.1 \"\"      scal…\n 8 197703  177    06500       1      13 197703065…       2     0.3 \"\"      scal…\n 9 197703  177    06500       2      14 197703065…    1897   154.  \"\"      scal…\n10 197703  177    06520       1      15 197703065…      22     5   \"\"      scal…\n# … with 15,423 more rows, 2 more variables: SEASON <chr>, YEAR <int>, and\n#   abbreviated variable names ¹​EXPCATCHNUM, ²​EXPCATCHWT, ³​CATCH_COMMENT\n```\n:::\n\n```{.r .cell-code}\ndata.frame(table(scallopCat$YEAR))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Var1 Freq\n1  1977  244\n2  1978  287\n3  1979  240\n4  1980  317\n5  1981  268\n6  1982  346\n7  1983  424\n8  1984  387\n9  1985  433\n10 1986  392\n11 1987  472\n12 1988  487\n13 1989  367\n14 1990  389\n15 1991  395\n16 1992  367\n17 1993  404\n18 1994  423\n19 1995  431\n20 1996  391\n21 1997  432\n22 1998  470\n23 1999  354\n24 2000  423\n25 2001  483\n26 2002  461\n27 2003  422\n28 2004  510\n29 2005  482\n30 2006  490\n31 2007  534\n32 2008  423\n33 2009  382\n34 2010  440\n35 2011  289\n36 2012  201\n37 2013  181\n38 2014  119\n39 2015  170\n40 2016  140\n41 2017  120\n42 2018  149\n43 2019  112\n44 2021   76\n45 2022  106\n```\n:::\n\n```{.r .cell-code}\ncat <- left_join(scallopCat, df_stations)\n\n# Find strata with all 45 years of data -----------------------------------------------------\n\n#This will show you which ones were removed\n# scallopsTest <-  scallopsNew %>%\n#   mutate(strat = as.integer(STRATUM)) %>% \n#   filter(is.na(strat))\n\n#shows how many occurrences of each stratum are in the data (i.e. how many years that stratum was sampled)\ndata.frame(table(cat$STRATUM))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Var1 Freq\n1  06010    5\n2  06020    9\n3  06030   10\n4  06040    5\n5  06050    7\n6  06060  117\n7  06070   86\n8  06080    6\n9  06090   44\n10 06100  257\n11 06110  334\n12 06120   24\n13 06130   40\n14 06140  391\n15 06150  499\n16 06160   49\n17 06170   51\n18 06180  419\n19 06190  470\n20 06200   18\n21 06210   83\n22 06220  327\n23 06230  711\n24 06240  158\n25 06250  183\n26 06260  341\n27 06270  559\n28 06280  145\n29 06290  192\n30 06300  443\n31 06310  790\n32 06320   32\n33 06330  225\n34 06340  365\n35 06350  169\n36 06360    1\n37 06370   35\n38 06380   52\n39 06390   13\n40 06400    2\n41 06410   15\n42 06420    5\n43 06440    3\n44 06450    7\n45 06460  190\n46 06470  567\n47 06480   23\n48 06490  306\n49 06500  600\n50 06510  454\n51 06520  477\n52 06530  397\n53 06540  389\n54 06550  328\n55 06560   14\n56 06570   27\n57 06580  188\n58 06590  375\n59 06600  334\n60 06610  350\n61 06620   38\n62 06621  471\n63 06622   90\n64 06630   28\n65 06631   71\n66 06632   78\n67 06640  306\n68 06650   44\n69 06651  365\n70 06652  170\n71 06660   52\n72 06661  362\n73 06662  123\n74 06670    8\n75 06680    2\n76 06700    1\n77 06710  327\n78 06720   76\n79 06730    9\n80 06740   82\n81 06990   14\n```\n:::\n\n```{.r .cell-code}\ndata.frame(table(len$STRATUM))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    Var1  Freq\n1  06010    20\n2  06020    34\n3  06030    24\n4  06040    10\n5  06050    36\n6  06060  1143\n7  06070   608\n8  06080    27\n9  06090   322\n10 06100  4407\n11 06110  8417\n12 06120    82\n13 06130  1212\n14 06140  9907\n15 06150 14760\n16 06160   301\n17 06170  1533\n18 06180 19529\n19 06190 14057\n20 06200    71\n21 06210  2185\n22 06220  7065\n23 06230 18799\n24 06240  1418\n25 06250  4076\n26 06260  6374\n27 06270 13634\n28 06280  1211\n29 06290  3332\n30 06300  7437\n31 06310 13169\n32 06320    99\n33 06330  3314\n34 06340  5973\n35 06350  1576\n36 06360     1\n37 06370   305\n38 06380   621\n39 06390    61\n40 06400     2\n41 06410    56\n42 06420    42\n43 06440    10\n44 06450    39\n45 06460  5432\n46 06470 18852\n47 06480   229\n48 06490  5415\n49 06500 30044\n50 06510 13663\n51 06520 16254\n52 06530 10792\n53 06540 10884\n54 06550  5658\n55 06560    67\n56 06570   156\n57 06580  3026\n58 06590  6817\n59 06600  5783\n60 06610  7454\n61 06620   491\n62 06621 13447\n63 06622  1806\n64 06630   302\n65 06631   444\n66 06632  1050\n67 06640  7326\n68 06650   559\n69 06651 11073\n70 06652  5110\n71 06660   759\n72 06661 12692\n73 06662  3595\n74 06670   253\n75 06680    25\n76 06700     2\n77 06710 17655\n78 06720  1002\n79 06730    57\n80 06740   686\n81 06990    82\n```\n:::\n\n```{.r .cell-code}\ncatTest <- cat %>% \n  group_by(STRATUM) %>% \n  summarise(years=n_distinct(YEAR))\n\nlenTest <- len %>% \n  group_by(STRATUM) %>% \n  summarise(years=n_distinct(YEAR))\n\n# Predators ---------------------------------------------------------------\n\nspeciesLen <- dat_len %>% \n  group_by(SCIENTIFIC_NAME) %>% \n  summarise(avg = mean(LENGTH))\n\nspeciesCat <- dat_cat %>% \n  group_by(SCIENTIFIC_NAME) %>% \n  summarise(count = n_distinct(ID))\n\n\n########## crabs\ncrabsLen <- dat_len %>% \n  filter(SCIENTIFIC_NAME==\"Cancer borealis (Jonah crab)\" | \n           SCIENTIFIC_NAME ==\"Cancer irroratus (Atlantic rock crab)\") %>%\n  mutate(CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         STATION = as.numeric(STATION),\n         .keep = \"unused\")\n\ncrabsLen <- left_join(crabsLen, cruises, by=\"CRUISE6\")\ncrabsTest <- crabsLen %>% \n  group_by(STRATUM) %>% \n  summarise(years=n_distinct(YEAR))\n\ncrabsCat <- dat_cat %>% \n  filter(SCIENTIFIC_NAME==\"Cancer borealis (Jonah crab)\" | \n           SCIENTIFIC_NAME ==\"Cancer irroratus (Atlantic rock crab)\") %>%\n  mutate(CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         STATION = as.numeric(STATION),\n         .keep = \"unused\")\n\ncrabsCat <- left_join(crabsCat, cruises, by=\"CRUISE6\")\ncrabsTest2 <- crabsCat %>% \n  group_by(STRATUM) %>% \n  summarise(years=n_distinct(YEAR))\n\n\n########## starfish\n\nstarLen <- dat_len %>% \n  filter(SCIENTIFIC_NAME==\"Astropecten\" | #none\n        SCIENTIFIC_NAME ==\"Astropecten articulatus (royal sea star)\" | #none\n        SCIENTIFIC_NAME ==\"Asterias\" | #one\n        SCIENTIFIC_NAME ==\"Asterias rubens (boreal asterias)\"  ) %>% #one\n  mutate(CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         STATION = as.numeric(STATION),\n         .keep = \"unused\")\n\nstarLen <- left_join(starLen, cruises, by=\"CRUISE6\")\nstarTest <- starLen %>% \n  group_by(STRATUM) %>% \n  summarise(years=n_distinct(YEAR))\n\nstarCat <- dat_cat %>% \n  filter(SCIENTIFIC_NAME==\"Astropecten\" |\n           SCIENTIFIC_NAME ==\"Astropecten articulatus (royal sea star)\" |\n           SCIENTIFIC_NAME ==\"Asterias\" |\n           SCIENTIFIC_NAME ==\"Asterias rubens (boreal asterias)\"  ) %>%\n  mutate(CRUISE6 = as.factor(CRUISE6),\n         CRUISE = as.factor(CRUISE),\n         STATION = as.numeric(STATION),\n         .keep = \"unused\")\n\nstarCat <- left_join(starCat, cruises, by=\"CRUISE6\")\nstarTest2 <- starCat %>% \n  group_by(STRATUM, SCIENTIFIC_NAME) %>% \n  summarise(years=n_distinct(YEAR))\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}